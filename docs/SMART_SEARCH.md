# –£–º–Ω—ã–π –ø–æ–∏—Å–∫ (Smart Search)

## –ö–æ–Ω—Ü–µ–ø—Ü–∏—è

"–£–º–Ω—ã–π –ø–æ–∏—Å–∫" - —ç—Ç–æ –ø—Ä–µ–º–∏—É–º-—Ñ—É–Ω–∫—Ü–∏—è –±–æ—Ç–∞, –≤–¥–æ—Ö–Ω–æ–≤–ª–µ–Ω–Ω–∞—è "–í–∞—É-–ø–æ–∏—Å–∫–æ–º" –∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –°–∞–º–æ–∫–∞—Ç. –ü–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –∏—Å–∫–∞—Ç—å –≤–∞–∫–∞–Ω—Å–∏–∏ –≤ —Å–≤–æ–±–æ–¥–Ω–æ–π —Ñ–æ—Ä–º–µ, –∞ LLM –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–∞—Ä—Å–∏—Ç –∑–∞–ø—Ä–æ—Å –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è HH API.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí –ö–Ω–æ–ø–∫–∞ "üß† –£–º–Ω—ã–π –ø–æ–∏—Å–∫" ‚Üí FSM —Å–æ—Å—Ç–æ—è–Ω–∏–µ ‚Üí LLM –ø–∞—Ä—Å–∏–Ω–≥ ‚Üí HH API –ø–æ–∏—Å–∫ ‚Üí –†–µ–∑—É–ª—å—Ç–∞—Ç—ã
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

1. **Frontend (Telegram)**
   - –ö–Ω–æ–ø–∫–∞ "üß† –£–º–Ω—ã–π –ø–æ–∏—Å–∫" –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é
   - FSM —Å–æ—Å—Ç–æ—è–Ω–∏–µ `waiting_for_smart_query`
   - –ü–æ–∫–∞–∑ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø–µ—Ä–µ–¥ –ø–æ–∏—Å–∫–æ–º

2. **LLM –ø–∞—Ä—Å–µ—Ä** (`llm_service.py`)
   - –ú–µ—Ç–æ–¥ `parse_smart_search_query()`
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Groq API (Llama 3.3 70B)
   - Temperature: 0.2 (–¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏)
   - Max tokens: 300

3. **Backend –æ–±—Ä–∞–±–æ—Ç—á–∏–∫** (`handlers/search.py`)
   - `handle_smart_search_query()` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ FSM
   - `perform_smart_search()` - –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ–∏—Å–∫–∞
   - –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ city names –≤ area IDs

4. **HH API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** (`hh_api.py`)
   - –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π `search_vacancies()` —Å –Ω–æ–≤—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ `schedule` –∏ `employment`

## –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

### text (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π)
–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞: –¥–æ–ª–∂–Ω–æ—Å—Ç—å, —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏, –Ω–∞–≤—ã–∫–∏

**–ü—Ä–∏–º–µ—Ä—ã:**
- "Python"
- "Frontend —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫"
- "DevOps engineer"
- "–ê–Ω–∞–ª–∏—Ç–∏–∫ –¥–∞–Ω–Ω—ã—Ö"

### area (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
–ì–æ—Ä–æ–¥ –ø–æ–∏—Å–∫–∞ (–Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç—Å—è –≤ ID —á–µ—Ä–µ–∑ `POPULAR_AREAS`)

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –≥–æ—Ä–æ–¥–∞:**
- –º–æ—Å–∫–≤–∞ ‚Üí 1
- —Å–ø–±, —Å–∞–Ω–∫—Ç-–ø–µ—Ç–µ—Ä–±—É—Ä–≥, –ø–∏—Ç–µ—Ä ‚Üí 2
- –µ–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥ ‚Üí 3
- –Ω–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫ ‚Üí 4
- –∫–∞–∑–∞–Ω—å ‚Üí 88
- –Ω–∏–∂–Ω–∏–π –Ω–æ–≤–≥–æ—Ä–æ–¥ ‚Üí 66
- –∏ –¥—Ä—É–≥–∏–µ...

### salary (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∑–∞—Ä–ø–ª–∞—Ç–∞ –≤ —Ä—É–±–ª—è—Ö

**–ü—Ä–∏–º–µ—Ä—ã:**
- 150000
- 200000
- 80000

### experience (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
–û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã

**–ó–Ω–∞—á–µ–Ω–∏—è:**
- `noExperience` - –ë–µ–∑ –æ–ø—ã—Ç–∞ / –°—Ç—É–¥–µ–Ω—Ç / –ù–∞—á–∏–Ω–∞—é—â–∏–π
- `between1And3` - 1-3 –≥–æ–¥–∞ / Junior
- `between3And6` - 3-6 –ª–µ—Ç / Middle
- `moreThan6` - 6+ –ª–µ—Ç / Senior

**–°–∏–Ω–æ–Ω–∏–º—ã:**
- "—Å—Ç—É–¥–µ–Ω—Ç", "–±–µ–∑ –æ–ø—ã—Ç–∞", "–Ω–∞—á–∏–Ω–∞—é—â–∏–π" ‚Üí noExperience
- "–¥–∂—É–Ω", "junior" ‚Üí between1And3
- "–º–∏–¥–ª", "middle" ‚Üí between3And6
- "—Å–µ–Ω—å–æ—Ä", "senior" ‚Üí moreThan6

### schedule (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
–ì—Ä–∞—Ñ–∏–∫ —Ä–∞–±–æ—Ç—ã

**–ó–Ω–∞—á–µ–Ω–∏—è:**
- `remote` - –£–¥–∞–ª–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞
- `flexible` - –ì–∏–±–∫–∏–π –≥—Ä–∞—Ñ–∏–∫
- `fullDay` - –ü–æ–ª–Ω—ã–π –¥–µ–Ω—å
- `shift` - –°–º–µ–Ω–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫
- `flyInFlyOut` - –í–∞—Ö—Ç–æ–≤—ã–π –º–µ—Ç–æ–¥

**–°–∏–Ω–æ–Ω–∏–º—ã:**
- "—É–¥–∞–ª–µ–Ω–∫–∞", "—É–¥–∞–ª–µ–Ω–Ω–æ", "remote" ‚Üí remote
- "–≥–∏–±–∫–∏–π –≥—Ä–∞—Ñ–∏–∫", "—Å–≤–æ–±–æ–¥–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫" ‚Üí flexible
- "–ø–æ–ª–Ω—ã–π –¥–µ–Ω—å", "–æ—Ñ–∏—Å" ‚Üí fullDay

### employment (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
–¢–∏–ø –∑–∞–Ω—è—Ç–æ—Å—Ç–∏

**–ó–Ω–∞—á–µ–Ω–∏—è:**
- `full` - –ü–æ–ª–Ω–∞—è –∑–∞–Ω—è—Ç–æ—Å—Ç—å
- `part` - –ß–∞—Å—Ç–∏—á–Ω–∞—è –∑–∞–Ω—è—Ç–æ—Å—Ç—å
- `project` - –ü—Ä–æ–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞
- `volunteer` - –í–æ–ª–æ–Ω—Ç–µ—Ä—Å—Ç–≤–æ
- `probation` - –°—Ç–∞–∂–∏—Ä–æ–≤–∫–∞

**–°–∏–Ω–æ–Ω–∏–º—ã:**
- "–ø–æ–ª–Ω–∞—è –∑–∞–Ω—è—Ç–æ—Å—Ç—å", "–ø–æ–ª–Ω—ã–π –¥–µ–Ω—å" ‚Üí full
- "–ø–æ–¥—Ä–∞–±–æ—Ç–∫–∞", "—á–∞—Å—Ç–∏—á–Ω–∞—è" ‚Üí part
- "–ø—Ä–æ–µ–∫—Ç", "—Ñ—Ä–∏–ª–∞–Ω—Å" ‚Üí project

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –ü—Ä–æ—Å—Ç–æ–π –∑–∞–ø—Ä–æ—Å
**–í–≤–æ–¥:** "Python —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ —É–¥–∞–ª–µ–Ω–Ω–æ –æ—Ç 150000"

**LLM –ø–∞—Ä—Å–∏–Ω–≥:**
```json
{
  "text": "Python —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫",
  "schedule": "remote",
  "salary": 150000
}
```

**–ü–æ–∫–∞–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é:**
```
üîç –ò—â—É: Python —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫
üïê –ì—Ä–∞—Ñ–∏–∫: –£–¥–∞–ª–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞
üí∞ –û—Ç 150 000 ‚ÇΩ
```

**HH API –∑–∞–ø—Ä–æ—Å:**
```
GET /vacancies?text=Python+—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫&schedule=remote&salary=150000
```

---

### –ü—Ä–∏–º–µ—Ä 2: –ó–∞–ø—Ä–æ—Å —Å –≥–æ—Ä–æ–¥–æ–º –∏ –æ–ø—ã—Ç–æ–º
**–í–≤–æ–¥:** "Junior frontend –≤ –ú–æ—Å–∫–≤–µ"

**LLM –ø–∞—Ä—Å–∏–Ω–≥:**
```json
{
  "text": "frontend",
  "area": "–º–æ—Å–∫–≤–∞",
  "experience": "between1And3"
}
```

**–ü–æ–∫–∞–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é:**
```
üîç –ò—â—É: frontend
üìç –ì–æ—Ä–æ–¥: –ú–æ—Å–∫–≤–∞
üìä –û–ø—ã—Ç: Junior (1-3 –≥–æ–¥–∞)
```

**HH API –∑–∞–ø—Ä–æ—Å:**
```
GET /vacancies?text=frontend&area=1&experience=between1And3
```

---

### –ü—Ä–∏–º–µ—Ä 3: –†–∞–±–æ—Ç–∞ –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–∞
**–í–≤–æ–¥:** "–•–æ—á—É —Ä–∞–±–æ—Ç—É –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–∞ —Å –≥–∏–±–∫–∏–º –≥—Ä–∞—Ñ–∏–∫–æ–º"

**LLM –ø–∞—Ä—Å–∏–Ω–≥:**
```json
{
  "text": "—Å—Ç—É–¥–µ–Ω—Ç",
  "experience": "noExperience",
  "schedule": "flexible"
}
```

**–ü–æ–∫–∞–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é:**
```
üîç –ò—â—É: —Å—Ç—É–¥–µ–Ω—Ç
üìä –û–ø—ã—Ç: –ë–µ–∑ –æ–ø—ã—Ç–∞
üïê –ì—Ä–∞—Ñ–∏–∫: –ì–∏–±–∫–∏–π –≥—Ä–∞—Ñ–∏–∫
```

---

### –ü—Ä–∏–º–µ—Ä 4: –ü–æ–¥—Ä–∞–±–æ—Ç–∫–∞
**–í–≤–æ–¥:** "–ù—É–∂–Ω–∞ –ø–æ–¥—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–∞"

**LLM –ø–∞—Ä—Å–∏–Ω–≥:**
```json
{
  "text": "—Å—Ç—É–¥–µ–Ω—Ç",
  "employment": "part",
  "experience": "noExperience"
}
```

**–ü–æ–∫–∞–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é:**
```
üîç –ò—â—É: —Å—Ç—É–¥–µ–Ω—Ç
üìä –û–ø—ã—Ç: –ë–µ–∑ –æ–ø—ã—Ç–∞
üíº –ó–∞–Ω—è—Ç–æ—Å—Ç—å: –ß–∞—Å—Ç–∏—á–Ω–∞—è –∑–∞–Ω—è—Ç–æ—Å—Ç—å
```

---

### –ü—Ä–∏–º–µ—Ä 5: –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∑–∞–ø—Ä–æ—Å
**–í–≤–æ–¥:** "–ò—â—É middle DevOps –≤ –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥–µ –Ω–∞ —É–¥–∞–ª–µ–Ω–∫—É –æ—Ç 200000"

**LLM –ø–∞—Ä—Å–∏–Ω–≥:**
```json
{
  "text": "DevOps",
  "area": "—Å–ø–±",
  "experience": "between3And6",
  "schedule": "remote",
  "salary": 200000
}
```

**–ü–æ–∫–∞–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é:**
```
üîç –ò—â—É: DevOps
üìç –ì–æ—Ä–æ–¥: –°–ø–±
üìä –û–ø—ã—Ç: Middle (3-6 –ª–µ—Ç)
üïê –ì—Ä–∞—Ñ–∏–∫: –£–¥–∞–ª–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞
üí∞ –û—Ç 200 000 ‚ÇΩ
```

## LLM Prompt

### System Prompt
```
–¢—ã - –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ–∏—Å–∫–∞ —Ä–∞–±–æ—Ç—ã –Ω–∞ hh.ru.
–¢–≤–æ—è –∑–∞–¥–∞—á–∞ - –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞.

–î–û–°–¢–£–ü–ù–´–ï –ü–ê–†–ê–ú–ï–¢–†–´:
1. text (string) - –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ (–¥–æ–ª–∂–Ω–æ—Å—Ç—å, —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏)
2. area (string) - –≥–æ—Ä–æ–¥: "–º–æ—Å–∫–≤–∞", "—Å–ø–±", "–µ–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥", "–Ω–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫", "–∫–∞–∑–∞–Ω—å", etc
3. salary (number) - –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∑–∞—Ä–ø–ª–∞—Ç–∞ –≤ —Ä—É–±–ª—è—Ö
4. experience (string):
   - "noExperience" - –Ω–µ—Ç –æ–ø—ã—Ç–∞ / —Å—Ç—É–¥–µ–Ω—Ç / –Ω–∞—á–∏–Ω–∞—é—â–∏–π
   - "between1And3" - 1-3 –≥–æ–¥–∞ / junior
   - "between3And6" - 3-6 –ª–µ—Ç / middle
   - "moreThan6" - –±–æ–ª–µ–µ 6 –ª–µ—Ç / senior
5. schedule (string):
   - "remote" - —É–¥–∞–ª–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞
   - "flexible" - –≥–∏–±–∫–∏–π –≥—Ä–∞—Ñ–∏–∫
   - "fullDay" - –ø–æ–ª–Ω—ã–π –¥–µ–Ω—å
6. employment (string):
   - "full" - –ø–æ–ª–Ω–∞—è –∑–∞–Ω—è—Ç–æ—Å—Ç—å
   - "part" - —á–∞—Å—Ç–∏—á–Ω–∞—è –∑–∞–Ω—è—Ç–æ—Å—Ç—å
   - "project" - –ø—Ä–æ–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞

–ü–†–ê–í–ò–õ–ê:
- –ò–∑–≤–ª–µ–∫–∞–π —Ç–æ–ª—å–∫–æ —è–≤–Ω–æ —É–ø–æ–º—è–Ω—É—Ç—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- –ï—Å–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä –Ω–µ —É–ø–æ–º—è–Ω—É—Ç - –Ω–µ –≤–∫–ª—é—á–∞–π –µ–≥–æ –≤ –æ—Ç–≤–µ—Ç
- text –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –¥–æ–ª–∂–Ω–æ—Å—Ç—å –∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
- salary - —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è —Å—É–º–º–∞
- –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–π —Å–∏–Ω–æ–Ω–∏–º—ã: "—É–¥–∞–ª—ë–Ω–∫–∞"=remote, "–¥–∂—É–Ω"=noExperience, "–º–∏–¥–ª"=between3And6

–û—Ç–≤–µ—Ç—å –¢–û–õ–¨–ö–û –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞.
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞
- **Temperature:** 0.2 (–Ω–∏–∑–∫–∞—è –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏)
- **Max tokens:** 300
- **Model:** llama-3.3-70b-versatile

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### LLM –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
```python
if groq_service is None:
    await message.answer(
        "‚ùå –£–º–Ω—ã–π –ø–æ–∏—Å–∫ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.\n"
        "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–±—ã—á–Ω—ã–π –ø–æ–∏—Å–∫ —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É üîç –ü–æ–∏—Å–∫ —Ä–∞–±–æ—Ç—ã"
    )
```

### –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON
```python
except json.JSONDecodeError:
    logger.error(f"–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å JSON –æ—Ç–≤–µ—Ç: {response}")
    return {"text": user_query}  # Fallback –Ω–∞ –æ–±—ã—á–Ω—ã–π –ø–æ–∏—Å–∫
```

### –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç text –≤ –æ—Ç–≤–µ—Ç–µ
```python
if "text" not in result:
    result["text"] = user_query  # –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å
```

### –ì–æ—Ä–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω
```python
if area_name in POPULAR_AREAS:
    area_id = POPULAR_AREAS[area_name]
else:
    area_id = None  # –ü–æ–∏—Å–∫ –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–∞ –ø–æ –≥–æ—Ä–æ–¥—É
```

## User Flow

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "üß† –£–º–Ω—ã–π –ø–æ–∏—Å–∫"**
   - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è FSM —Å–æ—Å—Ç–æ—è–Ω–∏–µ `waiting_for_smart_query`
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏

2. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –∑–∞–ø—Ä–æ—Å –≤ —Å–≤–æ–±–æ–¥–Ω–æ–π —Ñ–æ—Ä–º–µ**
   - "–•–æ—á—É —É–¥–∞–ª–µ–Ω–Ω—É—é —Ä–∞–±–æ—Ç—É python –æ—Ç 150000"

3. **–ë–æ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å**
   - "üß† –ê–Ω–∞–ª–∏–∑–∏—Ä—É—é –∑–∞–ø—Ä–æ—Å..."

4. **LLM –ø–∞—Ä—Å–∏—Ç –∑–∞–ø—Ä–æ—Å**
   - –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Groq API
   - –ü–∞—Ä—Å–∏–Ω–≥ JSON –æ—Ç–≤–µ—Ç–∞
   - –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

5. **–ë–æ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã**
   ```
   üîç –ò—â—É: python
   üïê –ì—Ä–∞—Ñ–∏–∫: –£–¥–∞–ª–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞
   üí∞ –û—Ç 150 000 ‚ÇΩ
   ```

6. **–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ–∏—Å–∫ –Ω–∞ HH**
   - –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
   - –ó–∞–ø—Ä–æ—Å –∫ HH API
   - –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

7. **–ü–æ–∫–∞–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤**
   ```
   üß† –£–º–Ω—ã–π –ø–æ–∏—Å–∫ –Ω–∞—à—ë–ª 245 –≤–∞–∫–∞–Ω—Å–∏–π

   –ü–æ–∫–∞–∑—ã–≤–∞—é –ø–µ—Ä–≤—ã–µ 20 –≤–∞–∫–∞–Ω—Å–∏–π:
   ```

8. **–ü–∞–≥–∏–Ω–∞—Ü–∏—è**
   - –ö–∞–∫ –≤ –æ–±—ã—á–Ω–æ–º –ø–æ–∏—Å–∫–µ
   - –°–µ—Å—Å–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `search_manager`

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø–µ—Ä–µ–¥ –æ–±—ã—á–Ω—ã–º –ø–æ–∏—Å–∫–æ–º

| –û–±—ã—á–Ω—ã–π –ø–æ–∏—Å–∫ | –£–º–Ω—ã–π –ø–æ–∏—Å–∫ |
|--------------|-------------|
| "Python –º–æ—Å–∫–≤–∞ 150000" | "–•–æ—á—É —É–¥–∞–ª–µ–Ω–Ω—É—é —Ä–∞–±–æ—Ç—É python –æ—Ç 150000" |
| –ù—É–∂–Ω–æ –∑–Ω–∞—Ç—å —Å–∏–Ω—Ç–∞–∫—Å–∏—Å | –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–∞—è —Ä–µ—á—å |
| –¢–æ–ª—å–∫–æ text, area, salary | –í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (schedule, employment) |
| –ù–µ—Ç –ø–æ–∫–∞–∑–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ | –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —á—Ç–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–ª |
| –ü—Ä–æ—Å—Ç–æ–π –ø–∞—Ä—Å–∏–Ω–≥ | LLM –ø–æ–Ω–∏–º–∞–µ—Ç –Ω–∞–º–µ—Ä–µ–Ω–∏—è |

## –ú–µ—Ç—Ä–∏–∫–∏ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

–í –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —Ñ–ª–∞–≥ `smart_search: true`:

```python
search_params = json.dumps({
    "area": area_id,
    "salary": salary,
    "experience": experience,
    "schedule": schedule,
    "employment": employment,
    "smart_search": True  # –ú–∞—Ä–∫–µ—Ä —É–º–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
})
```

–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç:
- –û—Ç—Å–ª–µ–¥–∏—Ç—å –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏
- –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ –ø–∞—Ä—Å–∏–Ω–≥–∞
- –°—Ä–∞–≤–Ω–∏—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –æ–±—ã—á–Ω–æ–≥–æ –∏ —É–º–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞

## –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

### –í–µ—Ä—Å–∏—è 2.1
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ professional_role –∏–∑ HH API
- [ ] –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –∑–∞—Ä–ø–ª–∞—Ç (–æ—Ç-–¥–æ)
- [ ] –ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç—å (–∞–Ω–≥–ª–∏–π—Å–∫–∏–π)

### –í–µ—Ä—Å–∏—è 2.2
- [ ] –ò—Å—Ç–æ—Ä–∏—è —É–º–Ω—ã—Ö –ø–æ–∏—Å–∫–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- [ ] –£–º–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ç–æ—Ä–∏–∏
- [ ] A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤

### –í–µ—Ä—Å–∏—è 2.3
- [ ] –ö–æ–Ω–≤–µ—Ä—Å–∞—Ü–∏–æ–Ω–Ω—ã–π —Ä–µ–∂–∏–º (—É—Ç–æ—á–Ω—è—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã)
- [ ] "–ü–æ—Ö–æ–∂–∏–µ –≤–∞–∫–∞–Ω—Å–∏–∏" —á–µ—Ä–µ–∑ embeddings
- [ ] –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### Unit —Ç–µ—Å—Ç—ã
```python
# –¢–µ—Å—Ç –ø–∞—Ä—Å–∏–Ω–≥–∞
async def test_parse_smart_search():
    query = "Python —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ —É–¥–∞–ª–µ–Ω–Ω–æ –æ—Ç 150000"
    result = await groq_service.parse_smart_search_query(query)

    assert result["text"] == "Python —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫"
    assert result["schedule"] == "remote"
    assert result["salary"] == 150000
```

### Integration —Ç–µ—Å—Ç—ã
```python
# –¢–µ—Å—Ç –ø–æ–ª–Ω–æ–≥–æ flow
async def test_smart_search_flow():
    # 1. –ù–∞–∂–∞—Ç–∏–µ –∫–Ω–æ–ø–∫–∏
    # 2. –í–≤–æ–¥ –∑–∞–ø—Ä–æ—Å–∞
    # 3. –ü–∞—Ä—Å–∏–Ω–≥ LLM
    # 4. –ü–æ–∏—Å–∫ HH
    # 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    pass
```

### –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
1. –ù–∞–∂–∞—Ç—å "üß† –£–º–Ω—ã–π –ø–æ–∏—Å–∫"
2. –í–≤–µ—Å—Ç–∏: "–•–æ—á—É —É–¥–∞–ª–µ–Ω–Ω—É—é —Ä–∞–±–æ—Ç—É python –æ—Ç 150000"
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–∫–∞–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞–≥–∏–Ω–∞—Ü–∏—é

## Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: LLM –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–µ JSON
**–†–µ—à–µ–Ω–∏–µ:** –£–≤–µ–ª–∏—á–µ–Ω–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –¥–æ 0.2, –¥–æ–±–∞–≤–ª–µ–Ω retry

### –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–µ—Ç —Å–∏–Ω–æ–Ω–∏–º—ã
**–†–µ—à–µ–Ω–∏–µ:** –†–∞—Å—à–∏—Ä–µ–Ω —Å–ø–∏—Å–æ–∫ —Å–∏–Ω–æ–Ω–∏–º–æ–≤ –≤ –ø—Ä–æ–º–ø—Ç–µ

### –ü—Ä–æ–±–ª–µ–º–∞: –ì–æ—Ä–æ–¥ –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è (lowercase, strip)

### –ü—Ä–æ–±–ª–µ–º–∞: –ú–µ–¥–ª–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç LLM
**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –±—ã—Å—Ç—Ä–∞—è –º–æ–¥–µ–ª—å Groq, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å—Ç–∞—Ç—É—Å "–ê–Ω–∞–ª–∏–∑–∏—Ä—É—é..."
