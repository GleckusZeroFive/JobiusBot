# JobiusBot - Telegram Бот для Поиска Работы

Telegram бот для поиска вакансий на hh.ru с дополнительными возможностями.

## Возможности

### Поиск работы:
- Поиск вакансий на hh.ru через API
- Динамическая загрузка 15,000+ городов России и СНГ из HeadHunter API
- Нечеткий поиск городов с поддержкой сокращений (Питер, СПб, МСК)
- Фильтры по зарплате (минимальная)
- Фильтры по уровню опыта (junior, middle, senior, lead, intern)
- Красивое форматирование результатов

### AI-ассистент (LLM):
- Интеллектуальный помощник на базе Groq API (llama-3.3-70b)
- Анализирует сообщения и помогает сфокусироваться на поиске работы
- Мягко направляет пользователя к функционалу бота
- Автоматическая классификация сообщений (по теме / offtopic)
- Сброс сессии при чрезмерном отклонении от темы работы
- Ротация API ключей для бесперебойной работы

### Дополнительно:
- Калькулятор для быстрых расчётов
- Поддержка математических операций: +, -, *, /, **, %, ()
- Избранное для сохранения интересных вакансий
- Статистика активности пользователя

## Установка и запуск

### 1. Получите токен бота

1. Откройте Telegram и найдите [@BotFather](https://t.me/BotFather)
2. Отправьте команду `/newbot`
3. Следуйте инструкциям: придумайте имя и username для бота
4. Скопируйте полученный токен (выглядит как `1234567890:ABCdefGHIjklMNOpqrsTUVwxyz`)

### 2. Настройте проект

```bash
# Клонируйте/скопируйте проект
cd JobiusBot

# Создайте виртуальное окружение (рекомендуется)
python3 -m venv venv
source venv/bin/activate  # на Windows: venv\Scripts\activate

# Установите зависимости
pip install -r requirements.txt

# Создайте .env файл из примера
cp .env.example .env

# Откройте .env и настройте:
# 1. TELEGRAM_BOT_TOKEN - токен от @BotFather
# 2. GROQ_API_KEY_1-4 - ключи от Groq (необязательно, но рекомендуется)
nano .env  # или любой другой редактор
```

### 2.1. Получение Groq API ключей (опционально)

Для работы AI-ассистента вам нужны API ключи от Groq:

1. Зарегистрируйтесь на [console.groq.com](https://console.groq.com)
2. Перейдите в раздел API Keys
3. Создайте до 4 ключей (для ротации нагрузки)
4. Добавьте их в `.env` файл как `GROQ_API_KEY_1`, `GROQ_API_KEY_2` и т.д.

**Примечание:** Бот работает и без Groq ключей, но без LLM функционала.

### 3. Запустите бота

#### Быстрый способ (рекомендуется):

```bash
./start.sh
```

Скрипт автоматически:
- Проверит, не запущен ли уже бот
- Создаст виртуальное окружение (если нужно)
- Установит зависимости (если нужно)
- Запустит бота в фоновом режиме
- Покажет PID процесса и путь к логам

#### Ручной способ:

```bash
python bot.py
```

Вы увидите сообщение: `Бот запущен!`

### 4. Протестируйте бота

1. Найдите вашего бота в Telegram по username
2. Нажмите `/start`
3. Отправьте математическое выражение, например: `2 + 2`
4. Бот ответит: `= 4`

## Управление ботом

### Удобные скрипты:

```bash
./start.sh      # Запустить бота
./stop.sh       # Остановить бота
./restart.sh    # Перезапустить бота
./status.sh     # Проверить статус (PID, CPU, память)
./logs.sh       # Показать последние 50 строк логов
./logs.sh 100   # Показать последние 100 строк
./logs.sh -f    # Отслеживать логи в реальном времени
./logs.sh -e    # Показать только ошибки
```

### Все скрипты автоматически:
- Проверяют состояние бота
- Корректно останавливают процессы (избегая дублирования)
- Выводят понятные сообщения
- Сохраняют логи в `logs/bot.log`

## Примеры использования

### Поиск работы:

```
Вы: /search Python
Бот: [Найдено 5000+ вакансий Python разработчика]

Вы: /search Python junior Москва
Бот: [Вакансии Python junior в Москве]

Вы: /search Backend middle СПб 200000
Бот: [Backend middle в СПб с зарплатой от 200к]

Вы: DevOps
Бот: [Автоматический поиск DevOps вакансий]
```

### Калькулятор:

```
Вы: /calc 2 + 2
Бот: = 4

Вы: 100 * 5
Бот: = 500
```

## Команды бота

### Поиск работы:
- `/search [запрос] [уровень] [город] [зарплата]` - Поиск вакансий
  - Примеры: `/search Python`, `/search Python junior Москва 150000`
- Просто напишите текст - бот автоматически найдёт вакансии

### Фильтры:
- **Уровни опыта**: junior, middle, senior, lead, intern (джуниор, миддл, сеньор, лид, стажер)
- **Города**: 15,000+ городов России и СНГ (загружаются автоматически из HeadHunter API)
  - Поддержка сокращений: Питер, СПб, МСК, НН, Екб
  - Нечеткий поиск: исправление опечаток
- **Зарплата**: любое число (минимальная зарплата)

### Другие команды:
- `/start` - Приветственное сообщение и инструкции
- `/help` - Подробная справка
- `/calc [выражение]` - Калькулятор

## Структура проекта

```
JobiusBot/
├── bot.py              # Основной код бота
├── requirements.txt    # Зависимости Python
├── .env.example        # Пример конфигурации
├── .env               # Ваши токены (не коммитится в git)
├── .gitignore         # Игнорируемые файлы
└── README.md          # Этот файл
```

## Деплой на VPS

### Создайте systemd service

```bash
# На сервере создайте файл
sudo nano /etc/systemd/system/jobiusbot.service
```

Содержимое:

```ini
[Unit]
Description=JobiusBot Telegram Calculator
After=network.target

[Service]
Type=simple
User=your_username
WorkingDirectory=/path/to/JobiusBot
Environment="PATH=/path/to/JobiusBot/venv/bin"
ExecStart=/path/to/JobiusBot/venv/bin/python bot.py
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

### Запустите service

```bash
# Перезагрузите systemd
sudo systemctl daemon-reload

# Включите автозапуск
sudo systemctl enable jobiusbot

# Запустите бота
sudo systemctl start jobiusbot

# Проверьте статус
sudo systemctl status jobiusbot

# Просмотр логов
sudo journalctl -u jobiusbot -f
```

## LLM Интеграция

### Как работает AI-ассистент:

1. **Классификация сообщений**: Комбинированный подход (ключевые слова + LLM)
2. **Отслеживание offtopic**: Счётчик нерелевантных сообщений
3. **Мягкие напоминания**: При отклонении от темы работы
4. **Сброс сессии**: При 3+ последовательных offtopic И 10+ общих offtopic
5. **Ротация ключей**: Round-robin между 4 API ключами

### Категории сообщений:

- `job_search` - поиск работы, вакансии, карьера
- `bot_help` - вопросы о функционале бота
- `calculator` - математические вычисления
- `offtopic` - всё остальное (не по теме)

## Безопасность

Бот использует ограниченный `eval()` для вычислений, который:
- Блокирует встроенные функции Python
- Разрешает только математические операторы
- Проверяет входные данные перед выполнением

**Важно:** Никогда не коммитьте `.env` файл с токенами в публичный репозиторий!
