#!/bin/bash
# ะกะบัะธะฟั ะดะปั ะฟัะพะฒะตัะบะธ ััะฐัััะฐ ะฑะพัะฐ

# ะะฟัะตะดะตะปัะตะผ ะบะพัะตะฝั ะฟัะพะตะบัะฐ
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
if [[ "$SCRIPT_DIR" == */scripts ]]; then
    PROJECT_ROOT="$(dirname "$SCRIPT_DIR")"
else
    PROJECT_ROOT="$SCRIPT_DIR"
fi
cd "$PROJECT_ROOT"

echo "๐ ะกัะฐััั ะฑะพัะฐ:"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"

# ะัะพะฒะตััะตะผ, ะทะฐะฟััะตะฝ ะปะธ ะฑะพั
PIDS=$(pgrep -f "python.*bot.py")

if [ -z "$PIDS" ]; then
    echo "โ ะะพั ะะ ะทะฐะฟััะตะฝ"
    echo ""
    echo "ะะฐะฟัััะธัะต ะฑะพัะฐ ะบะพะผะฐะฝะดะพะน: ./scripts/start.sh"
    exit 1
else
    echo "โ ะะพั ัะฐะฑะพัะฐะตั"
    echo ""

    # ะัะฒะพะดะธะผ ะธะฝัะพัะผะฐัะธั ะพ ะฟัะพัะตััะฐั
    echo "PID ะฟัะพัะตััะพะฒ: $PIDS"

    # ะกัะธัะฐะตะผ ะบะพะปะธัะตััะฒะพ ะฟัะพัะตััะพะฒ
    COUNT=$(echo "$PIDS" | wc -w)
    if [ "$COUNT" -gt 1 ]; then
        echo "โ๏ธ  ะะะะะะะะ: ะะฐะฟััะตะฝะพ $COUNT ะฟัะพัะตััะพะฒ ะฑะพัะฐ!"
        echo "   ะะตะบะพะผะตะฝะดัะตััั ะฟะตัะตะทะฐะฟัััะธัั: ./restart.sh"
    fi

    echo ""
    echo "ะัะฟะพะปัะทะพะฒะฐะฝะธะต ะฟะฐะผััะธ ะธ CPU:"
    ps aux | grep "[p]ython.*bot.py" | awk '{printf "  PID: %s | CPU: %s%% | MEM: %s%% | ะัะตะผั: %s\n", $2, $3, $4, $10}'

    echo ""
    echo "ะะพัะปะตะดะฝะธะต 10 ัััะพะบ ะธะท ะปะพะณะพะฒ:"
    echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
    if [ -f "logs/bot.log" ]; then
        tail -10 logs/bot.log
    else
        echo "โ๏ธ  ะคะฐะนะป ะปะพะณะพะฒ ะฝะต ะฝะฐะนะดะตะฝ"
    fi
fi

echo ""
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
