#!/bin/bash
# ะกะบัะธะฟั ะดะปั ะฟัะพัะผะพััะฐ ะปะพะณะพะฒ ะฑะพัะฐ

# ะะฟัะตะดะตะปัะตะผ ะบะพัะตะฝั ะฟัะพะตะบัะฐ
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
if [[ "$SCRIPT_DIR" == */scripts ]]; then
    PROJECT_ROOT="$(dirname "$SCRIPT_DIR")"
else
    PROJECT_ROOT="$SCRIPT_DIR"
fi
cd "$PROJECT_ROOT"

if [ ! -f "logs/bot.log" ]; then
    echo "โ ะคะฐะนะป ะปะพะณะพะฒ ะฝะต ะฝะฐะนะดะตะฝ"
    exit 1
fi

# ะัะพะฒะตััะตะผ ะฟะฐัะฐะผะตััั
if [ "$1" = "-f" ] || [ "$1" = "--follow" ]; then
    # ะะตะถะธะผ follow (ะบะฐะบ tail -f)
    echo "๐ ะััะปะตะถะธะฒะฐะฝะธะต ะปะพะณะพะฒ (Ctrl+C ะดะปั ะฒััะพะดะฐ)..."
    echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
    tail -f logs/bot.log
elif [ "$1" = "-e" ] || [ "$1" = "--errors" ]; then
    # ะะพะบะฐะทะฐัั ัะพะปัะบะพ ะพัะธะฑะบะธ
    echo "โ ะัะธะฑะบะธ ะฒ ะปะพะณะฐั:"
    echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
    grep -i "error\|exception\|traceback" logs/bot.log | tail -50
else
    # ะะพะบะฐะทะฐัั ะฟะพัะปะตะดะฝะธะต N ัััะพะบ (ะฟะพ ัะผะพะปัะฐะฝะธั 50)
    LINES=${1:-50}
    echo "๐ ะะพัะปะตะดะฝะธะต $LINES ัััะพะบ ะปะพะณะพะฒ:"
    echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
    tail -$LINES logs/bot.log
fi

echo ""
echo "ะัะฟะพะปัะทะพะฒะฐะฝะธะต:"
echo "  ./scripts/logs.sh         - ะฟะพัะปะตะดะฝะธะต 50 ัััะพะบ"
echo "  ./scripts/logs.sh 100     - ะฟะพัะปะตะดะฝะธะต 100 ัััะพะบ"
echo "  ./scripts/logs.sh -f      - ะพััะปะตะถะธะฒะฐะฝะธะต ะฒ ัะตะฐะปัะฝะพะผ ะฒัะตะผะตะฝะธ"
echo "  ./scripts/logs.sh -e      - ัะพะปัะบะพ ะพัะธะฑะบะธ"
